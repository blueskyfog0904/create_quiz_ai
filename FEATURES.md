# AI영어문제팩토리 - 프로젝트 기능 명세서

> 이 문서는 프로젝트의 모든 기능을 정리하고 구현 상태를 추적합니다.
> 기능 추가/수정 시 이 문서를 참고하고 업데이트해주세요.

---

## 목차

1. [헤더 네비게이션](#1-헤더-네비게이션)
2. [인증 시스템](#2-인증-시스템)
3. [AI 문제 생성](#3-ai-문제-생성)
4. [문제은행](#4-문제은행)
5. [내 라이브러리](#5-내-라이브러리)
6. [마이페이지](#6-마이페이지)
7. [관리자 기능](#7-관리자-기능)

---

## 1. 헤더 네비게이션

### 메뉴 구조

| 메뉴 | 경로 | 권한 | 상태 |
|------|------|------|------|
| Home (로고) | `/` | 전체 | ✅ 완료 |
| AI문제생성 | `/generate` | 로그인 | ✅ 완료 |
| 문제은행 | `/bank` | 로그인 | ✅ 완료 |
| 내 라이브러리 | 드롭다운 | 로그인 | ✅ 완료 |
| ㄴ 내가 구매한 문제 | `/library/purchased` | 로그인 | ✅ 완료 |
| ㄴ 문제지 관리 | `/library/exam-papers` | 로그인 | ✅ 완료 |
| 마이페이지 | 드롭다운 | 로그인 | ✅ 완료 |
| 내 이름 | - | 로그인 | ✅ 완료 |
| 로그아웃 | - | 로그인 | ✅ 완료 |
| 관리자 | `/admin/questions/upload` | 관리자 | ✅ 완료 |

### 관련 파일
- `src/components/layout/header.tsx` - 헤더 서버 컴포넌트
- `src/components/layout/header-client.tsx` - 헤더 클라이언트 컴포넌트 (드롭다운, 모바일 메뉴)

---

## 2. 인증 시스템

### 기능 목록

| 기능 | 경로 | 상태 | 설명 |
|------|------|------|------|
| 회원가입 | `/signup` | ✅ 완료 | 이메일 인증 필요 |
| 로그인 | `/login` | ✅ 완료 | 이메일/비밀번호 |
| 로그아웃 | - | ✅ 완료 | 헤더에서 실행 |
| 이메일 인증 | `/auth/callback` | ✅ 완료 | Supabase 콜백 |

### 회원가입 필드

| 필드 | 필수 | 설명 |
|------|------|------|
| 이메일 | ✅ | 아이디로 사용 |
| 비밀번호 | ✅ | 비밀번호 확인 포함 |
| 이름 | ✅ | 표시명 |
| 역할 | ✅ | 교사/학원강사 |
| 휴대폰 번호 | ❌ | 선택 |
| 생년월일 | ❌ | 선택 |
| 소속 | ❌ | 학교/학원명 |
| 성별 | ❌ | 선택 |
| 주소 | ❌ | 선택 |

### 관련 파일
- `src/app/(auth)/login/page.tsx` - 로그인 페이지
- `src/app/(auth)/signup/page.tsx` - 회원가입 페이지
- `src/app/(auth)/actions.ts` - 인증 액션
- `src/lib/auth.ts` - 인증 유틸리티

---

## 3. AI 문제 생성

### 기능 목록

| 기능 | 경로 | 상태 | 설명 |
|------|------|------|------|
| 문제 유형 선택 | `/generate` | ✅ 완료 | 활성화된 문제 유형 목록 |
| 단일 유형 생성 | `/generate/[typeId]` | ✅ 완료 | 선택한 유형으로 문제 생성 |
| 다중 유형 생성 | `/generate/multi` | ✅ 완료 | 여러 유형 동시 생성 |

### 문제 유형 (problem_types)
- OpenAI 기반 유형
- Gemini 기반 유형
- 관리자 업로드 유형 (AI 생성 제외)

### 관련 파일
- `src/app/(dashboard)/generate/page.tsx` - 유형 선택 페이지
- `src/app/(dashboard)/generate/[typeId]/` - 단일 생성
- `src/app/(dashboard)/generate/multi/` - 다중 생성
- `src/lib/ai/` - AI 통합 모듈

---

## 4. 문제은행

### 기능 목록

| 기능 | 경로 | 상태 | 설명 |
|------|------|------|------|
| 관리자 문제 목록 | `/bank` | ✅ 완료 | 관리자가 업로드한 문제 |
| 문제 필터링 | `/bank` | ✅ 완료 | 유형/학년/난이도 필터 |
| 내 문제로 가져오기 | `/bank` | ✅ 완료 | 커뮤니티 문제 복사 |

### 관련 파일
- `src/app/(dashboard)/bank/page.tsx` - 문제은행 페이지 (기존 community-bank)
- `src/app/(dashboard)/bank/bank-client.tsx` - 클라이언트 컴포넌트

---

## 5. 내 라이브러리

### 기능 목록

| 기능 | 경로 | 상태 | 설명 |
|------|------|------|------|
| 내가 구매한 문제 | `/library/purchased` | ✅ 완료 | 내가 생성/저장한 문제 목록 |
| 문제 필터링 | `/library/purchased` | ✅ 완료 | 유형/학년/난이도 필터 |
| 문제지 만들기 | `/library/purchased` | ✅ 완료 | 선택 문제로 문제지 생성 |
| 문제지 관리 | `/library/exam-papers` | ✅ 완료 | 생성된 문제지 목록 |
| 문제지 상세보기 | `/library/exam-papers/[id]` | ✅ 완료 | 문제지 내용 확인 |
| 문제지 내보내기 | `/library/exam-papers/[id]` | ✅ 완료 | DOCX/PDF 다운로드 |
| 문제지 삭제 | `/library/exam-papers` | ✅ 완료 | 문제지 삭제 |

### 관련 파일
- `src/app/(dashboard)/library/purchased/` - 구매한 문제 (기존 bank)
- `src/app/(dashboard)/library/exam-papers/` - 문제지 관리 (기존 exam-papers)

---

## 6. 마이페이지

### 기능 목록

| 기능 | 경로 | 상태 | 설명 |
|------|------|------|------|
| 마이페이지 대시보드 | `/mypage` | ✅ 완료 | 메인 대시보드 |
| 결제 내역 | `/mypage/payments` | 🔜 Coming Soon | 포인트 결제 내역 |
| 크레딧 관리 | `/mypage/credits` | 🔜 Coming Soon | 포인트 잔액/충전/사용 |
| 내정보 관리 | `/mypage/profile` | ✅ 완료 | 프로필 정보, 비밀번호 변경 |
| 생성/구매 히스토리 | `/mypage/history` | ✅ 완료 | 작업 통계 |
| 로그인 기기 관리 | `/mypage/devices` | ✅ 완료 | 세션/기기 관리 |
| 회원 탈퇴 | `/mypage/withdraw` | ✅ 완료 | 계정 삭제 |
| 고객지원 | `/mypage/support` | ✅ 완료 | 1:1 문의 |

### 결제 내역 (추후 개발)
- 구매 날짜
- 포인트 금액

### 크레딧 관리 (추후 개발)
- 현재 보유 포인트
- 포인트 충전 내역
- 포인트 사용 내역 (AI 문제 생성 / 문제 구매)

### 내정보 관리
- 이름 (변경 불가)
- 이메일 (변경 불가)
- 비밀번호 변경
- 역할 (교사 / 학원강사)
- 소속 학교 / 학원

### 생성/구매 히스토리
- 총 생성한 문제 수 (월별 / 누적)
- 총 생성한 문제지 수

### 로그인 기기 관리
- 최근 로그인 기록
- 로그인된 장치 목록
- "다른 기기 전체 로그아웃" 버튼
- 개별 기기 로그아웃

### 관련 파일
- `src/app/(dashboard)/mypage/` - 마이페이지 전체

---

## 7. 관리자 기능

### 기능 목록

| 기능 | 경로 | 상태 | 설명 |
|------|------|------|------|
| 관리자 업로드 | `/admin/questions/upload` | ✅ 완료 | 문제 일괄 업로드 |
| 문제 유형 관리 | `/admin/problem-types` | ✅ 완료 | 문제 유형 CRUD |

### 관련 파일
- `src/app/(dashboard)/admin/questions/upload/` - 문제 업로드
- `src/app/(admin)/admin/problem-types/` - 유형 관리

---

## 데이터베이스 테이블

### 기존 테이블

| 테이블 | 설명 |
|--------|------|
| `profiles` | 사용자 프로필 |
| `problem_types` | 문제 유형 정의 |
| `questions` | 생성된 문제 |
| `exam_papers` | 문제지 |
| `exam_paper_items` | 문제지-문제 연결 |

### 추가 테이블

| 테이블 | 설명 | 상태 |
|--------|------|------|
| `user_sessions` | 로그인 세션/기기 추적 | ✅ 완료 |
| `user_credits` | 사용자 크레딧 잔액 | ✅ 완료 |
| `credit_transactions` | 크레딧 거래 내역 | ✅ 완료 |
| `support_tickets` | 고객 문의 티켓 | ✅ 완료 |

---

## 라우트 매핑

### 기존 → 신규 라우트 변환

| 기존 경로 | 신규 경로 | 설명 |
|-----------|-----------|------|
| `/bank` | `/library/purchased` | 내가 구매한 문제 |
| `/exam-papers` | `/library/exam-papers` | 문제지 관리 |
| `/community-bank` | `/bank` | 문제은행 |

---

## 업데이트 기록

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2024-12-09 | 1.0.0 | 초기 문서 작성, 헤더 메뉴 재구성 |

---

## 참고사항

- 상태 표시: ✅ 완료, 🚧 진행중, 🔜 Coming Soon, ❌ 미구현
- 모든 인증 필요 페이지는 `requireAuth()` 사용
- 관리자 페이지는 `requireAdmin()` 사용
- 새 기능 추가 시 이 문서 업데이트 필수

